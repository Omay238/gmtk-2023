<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Game</title>
    <script src="./libraries/p5.min.js"></script>
    <script src="./libraries/p5.sound.min.js"></script>
    <script src="./libraries/matter.min.js"></script>
    <link rel="stylesheet" href="./styles/p5.css">
  </head>
  <body>
    <main></main>
    <script>
      //{% fake.js %}

      let tiles = [];
      let won = false;
      let moving;

      let { Engine, Bodies, Composite, Body, Vector, Detector } = Matter;

      console.log = (content) => {
        let doc = window.top.document;
        let create = (content) => {
          let container = doc.createElement("div");
          let cont = doc.createElement("p");
          let num = doc.createElement("p");
          cont.innerText = content;
          container.appendChild(num);
          container.appendChild(cont);
          container.classList.add("log");
          doc.querySelector("#console").appendChild(container);
        };
        if(doc.querySelector("#console").lastChild !== null){
          if(doc.querySelector("#console").lastChild.lastChild.innerText === content.toString()){
            if(doc.querySelector("#console").lastChild.firstChild.innerText === ''){
              doc.querySelector("#console").lastChild.firstChild.innerText = "2";
            }else{
              doc.querySelector("#console").lastChild.firstChild.innerText = parseInt(doc.querySelector("#console").lastChild.firstChild.innerText) + 1;
            }
          }else{
            create(content);
          }
        }else{
          create(content);
        }
        doc.querySelector("#console").scrollTo(0, doc.querySelector("#console").scrollHeight);
      };

      console.warn = (content) => {
        let doc = window.top.document;
        let create = (content) => {
          let container = doc.createElement("div");
          let cont = doc.createElement("p");
          let num = doc.createElement("p");
          cont.innerText = content;
          container.appendChild(num);
          container.appendChild(cont);
          container.classList.add("warn");
          doc.querySelector("#console").appendChild(container);
        };
        if(doc.querySelector("#console").lastChild !== null){
          if(doc.querySelector("#console").lastChild.lastChild.innerText === content.toString()){
            if(doc.querySelector("#console").lastChild.firstChild.innerText === ''){
              doc.querySelector("#console").lastChild.firstChild.innerText = "2";
            }else{
              doc.querySelector("#console").lastChild.firstChild.innerText = parseInt(doc.querySelector("#console").lastChild.firstChild.innerText) + 1;
            }
          }else{
            create(content);
          }
        }else{
          create(content);
        }
        doc.querySelector("#console").scrollTo(0, doc.querySelector("#console").scrollHeight);
      };

      console.error = (content) => {
        let doc = window.top.document;
        let create = (content) => {
          let container = doc.createElement("div");
          let cont = doc.createElement("p");
          let num = doc.createElement("p");
          cont.innerText = content;
          container.appendChild(num);
          container.appendChild(cont);
          container.classList.add("error");
          doc.querySelector("#console").appendChild(container);
        };
        if(doc.querySelector("#console").lastChild !== null){
          if(doc.querySelector("#console").lastChild.lastChild.innerText === content.toString()){
            if(doc.querySelector("#console").lastChild.firstChild.innerText === ''){
              doc.querySelector("#console").lastChild.firstChild.innerText = "2";
            }else{
              doc.querySelector("#console").lastChild.firstChild.innerText = parseInt(doc.querySelector("#console").lastChild.firstChild.innerText) + 1;
            }
          }else{
            create(content);
          }
        }else{
          create(content);
        }
        doc.querySelector("#console").scrollTo(0, doc.querySelector("#console").scrollHeight);
      };

      // create an engine
      let engine = Engine.create();

      let player, playerImage;

      let keys = [];

      let level = 0;

      let s;

      let groundBodies = [];

      function setup(){
        let scl = min(innerWidth, innerHeight);
        createCanvas(scl, scl);
        loadLevel(level);
        imageMode(CENTER);
        rectMode(CENTER);
        tiles[0].loadPixels();
        tiles[1].loadPixels();
        playerImage.loadPixels();
        console.log(playerImage.pixels);
      }

      function ithinkthisisimportant(){
        if(!moving){
          console.error("Error: 'I can't move!!' - player\nLines 66-110");
        }
        if(levels[1][2] !== "2222222201" && level === 1){
          console.error("Error: old level. Styling not up to date.\nLines 16-25");
        }
        if(tiles[0].pixels[0] === tiles[1].pixels[0]){
          console.error("Error: ground tiles not properly sourced.\nLines 118 and 119");
        }
        if(playerImage.pixels[2003] === 1){
          console.error("Error: player image not loaded correctly.\nLine 116");
        }
        let dumy = false;
        for(let i = 0; i < levels[2].length; i++){
          if(levels[2][i].length !== 10){
            dumy = true;
          }
        }
        if(dumy && level === 2){
          console.error("Error: improper line lengths and ids.\nLines 31-40");
        }
      }

      function keyPressed(){
        keys[keyCode] = true;
      }

      function keyReleased(){
        keys[keyCode] = false;
      }
    </script>
  </body>
</html>